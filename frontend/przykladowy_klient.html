<!DOCTYPE html>
<html>
<head>
    <title>WebSocket demo</title>
    <style type="text/css">
        body {
            font-family: "Courier New", sans-serif;
            text-align: center;
        }

        .buttons {
            font-size: 4em;
            display: flex;
            justify-content: center;
        }

        .button, .value {
            line-height: 1;
            padding: 2rem;
            margin: 2rem;
            border: medium solid;
            min-height: 1em;
            min-width: 1em;
        }

        .button {
            cursor: pointer;
            user-select: none;
        }

        .minus {
            color: red;
        }

        .plus {
            color: green;
        }

        .value {
            min-width: 2em;
        }

        .state {
            font-size: 2em;
        }
    </style>
</head>
<body>
<div class="buttons">
    <div class="minus button">-</div>
    <div class="value">?</div>
    <div class="plus button">+</div>
</div>
<div class="state">
    <span class="users">?</span>
</div>

    <hr>
    <input name='letter' type="text" id="letter"/>
    <button id='przyciskWyslij'>Wyslij</button>

<script>
    const FE_SEND_LETTER = 'FE_SEND_LETTER';

    let minus = document.querySelector('.minus');
    let plus = document.querySelector('.plus');
    let value = document.querySelector('.value');
    let users = document.querySelector('.users');
    let przyciskWyslij = document.getElementById('przyciskWyslij');
    let websocket = new WebSocket("ws://127.0.0.1:7000/");

    function wyslijLitere() {

        alert(letter.value);
    }


    websocket.onmessage = function (event) {
        data = JSON.parse(event.data);
        console.log(data)
        if (data.type === 'BE_NEW_THREAD_WAS_OPENED_TO_YOU') {
            const port = data.port;
            const ws = new WebSocket("ws://127.0.0.1:" + port + "/");
            console.log('stworzono websocket dla portu ' + port + '!');
            minus.onclick = (event) => {
                ws.send(JSON.stringify({action: 'minus'}));
            };
            plus.onclick = (event) => {
                ws.send(JSON.stringify({action: 'plus'}));
            };

            przyciskWyslij.onclick = (event) => {
                const letter = document.getElementById('letter');
                ws.send(JSON.stringify({type: 'FE_SEND_LETTER', value: letter}));
            };
            ws.onmessage = event => {
                data = JSON.parse(event.data);
                console.log(data)
                switch (data.type) {
                    case 'BE_GAME_PLUS_MINUS_STATE':
                        value.textContent = data.game_counter;
                        break;
                    case 'BE_NEW_PLAYER_CONNECTED':
                    case 'BE_PLAYER_DISCONNECTED':
                        users.textContent = (
                            data.number_of_players.toString() + " user" +
                            (data.count == 1 ? "" : "s") + ' online');
                        break;
                    case 'BE_NEW_THREAD_WAS_OPENED_TO_YOU':
                        const port = data.port;
                        break;
                    default:
                        console.warn(
                            "INFO => ", data);
                }
            }
        } else if (data.type === 'BE_WAITING_FOR_SECOND_PLAYER') {
             users.textContent = "Waiting for second user";
        }
    };

</script>
</body>
</html>